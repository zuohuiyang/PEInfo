# PE Analyzer & Hash Calculator - 功能总结

## 项目概述

这是一个32位C++ GUI应用程序，专为Windows系统设计，提供PE文件分析和哈希计算功能。项目采用模块化架构，使用Win32 API构建用户界面，符合C++17标准。

## 核心功能

### 1. PE文件分析器

#### 功能特性
- **文件加载**：支持拖放操作和文件选择对话框
- **PE结构解析**：完整解析DOS头、PE头、节表
- **导入表分析**：详细显示程序依赖的DLL和函数信息
- **树形显示**：使用树形控件清晰展示层级结构
- **详细信息**：显示函数名、序号、RVA（相对虚拟地址）

#### 技术实现
- 使用Windows文件API读取PE文件
- 解析DOS头签名（"MZ"）和PE签名（"PE\0\0"）
- 遍历导入表目录，提取DLL和函数信息
- 支持32位和64位PE文件格式
- 错误处理和异常安全

#### 用户界面
- 文件选择区域（支持拖放）
- 树形视图显示PE结构
- 状态栏显示当前操作状态
- 支持Unicode文件路径

### 2. 哈希计算器

#### 功能特性
- **多种算法**：支持MD5、SHA1、SHA256
- **输入模式**：支持文本输入和文件选择
- **结果显示**：显示哈希值和计算时间
- **操作控制**：提供计算和清除按钮
- **性能优化**：使用Windows CryptoAPI实现

#### 技术实现
- 使用Windows CryptoAPI进行哈希计算
- 支持大文件分块处理
- 精确计时显示计算性能
- 内存安全的数据处理

#### 用户界面
- 输入模式选择（文本/文件）
- 算法选择复选框
- 结果显示区域
- 操作按钮（计算/清除）

## 技术架构

### 模块化设计

```
PEAnalyzer/
├── PEParser.h/cpp          # PE文件解析模块
├── HashCalculator.h/cpp      # 哈希计算模块
├── PEAnalyzer.h/cpp        # 主应用程序和GUI
├── stdafx.h/cpp             # 预编译头文件
└── 资源文件                 # 图标、菜单、对话框
```

### 核心类设计

#### PEParser类
```cpp
class PEParser {
public:
    bool LoadPEFile(const std::wstring& filePath);
    bool ParseImportTable();
    std::vector<ImportDLL> GetImportDLLs() const;
    std::wstring GetLastError() const;
    
private:
    // PE文件数据和解析逻辑
};
```

#### HashCalculator类
```cpp
class HashCalculator {
public:
    bool CalculateFileHash(const std::wstring& filePath, HashType type);
    bool CalculateTextHash(const std::wstring& text, HashType type);
    std::wstring GetHashResult() const;
    double GetCalculationTime() const;
    
private:
    // CryptoAPI封装和哈希逻辑
};
```

#### PEAnalyzer类（主窗口）
```cpp
class PEAnalyzer {
public:
    bool Initialize(HINSTANCE hInstance);
    int Run();
    
private:
    // 窗口管理、消息处理、UI控件
};
```

## 技术规格

### 编译要求
- **编译器**：Visual Studio 2019/2022
- **C++标准**：C++17
- **目标平台**：32位 (x86)
- **运行时链接**：静态链接 (/MT)
- **Windows版本**：Windows 7及以上

### 依赖库
- **系统库**：
  - kernel32.lib（基本系统功能）
  - user32.lib（用户界面）
  - gdi32.lib（图形绘制）
  - comctl32.lib（通用控件）
  - shell32.lib（文件操作）
  - advapi32.lib（CryptoAPI）

### 项目配置
- **预处理器定义**：
  - `WIN32` - Windows平台
  - `NDEBUG` - 发布版本
  - `_WINDOWS` - Windows应用程序
  - `UNICODE` 和 `_UNICODE` - Unicode支持
- **编译选项**：
  - `/std:c++17` - C++17标准
  - `/MT` - 静态运行时链接
  - `/W3` - 警告级别3
  - `/O2` - 优化级别2

## 用户界面设计

### 主窗口布局
- **标题栏**：显示应用程序名称和版本
- **菜单栏**：文件、帮助等标准菜单
- **工具栏**：常用操作快捷按钮
- **标签页**：PE分析和哈希计算两个主要功能
- **状态栏**：显示当前状态和操作信息

### PE分析标签页
```
+---------------------------------------------+
| [选择文件] [拖放文件到此处]                |
+---------------------------------------------+
| PE文件结构树形视图                          |
| + notepad.exe                               |
|   + 导入表                                  |
|     + kernel32.dll                          |
|       - GetProcAddress (序号: 1, RVA: 1234) |
|       - LoadLibraryA (序号: 2, RVA: 1238)   |
|     + user32.dll                            |
|       - MessageBoxA (序号: 1, RVA: 5678)    |
+---------------------------------------------+
```

### 哈希计算标签页
```
+---------------------------------------------+
| 输入模式: ( ) 文本输入  ( ) 文件选择       |
+---------------------------------------------+
| 文本输入框 / 文件路径显示                   |
+---------------------------------------------+
| 哈希算法: [√] MD5 [√] SHA1 [√] SHA256      |
+---------------------------------------------+
| [计算哈希] [清除结果]                      |
+---------------------------------------------+
| 计算结果:                                   |
| MD5:    d41d8cd98f00b204e9800998ecf8427e  |
| SHA1:   da39a3ee5e6b4b0d3255bfef95601890  |
| SHA256: e3b0c44298fc1c149afbf4c8996fb924  |
| 计算时间: 0.001 秒                          |
+---------------------------------------------+
```

## 性能特点

### PE文件分析
- **快速解析**：优化的文件读取和解析算法
- **内存效率**：流式处理大文件，避免内存溢出
- **错误恢复**：遇到损坏的PE结构时优雅处理

### 哈希计算
- **高性能**：使用硬件加速的CryptoAPI
- **大文件支持**：分块处理大文件
- **准确计时**：高精度性能计时器

## 错误处理

### 文件操作错误
- 文件不存在或无法访问
- 文件格式不正确（非PE文件）
- 文件损坏或结构不完整

### 系统资源错误
- 内存分配失败
- CryptoAPI初始化失败
- 系统资源不足

### 用户界面反馈
- 状态栏错误信息显示
- 消息框错误提示
- 日志记录（可选）

## 安全考虑

### 文件访问安全
- 验证文件路径合法性
- 防止路径遍历攻击
- 适当的文件权限检查

### 内存安全
- 边界检查和缓冲区溢出防护
- 智能指针和RAII模式
- 异常安全的资源管理

### 输入验证
- 文件类型验证
- 输入长度限制
- Unicode处理安全

## 扩展性

### 模块化架构
- 独立的PE解析模块
- 可插拔的哈希算法
- 分离的GUI逻辑

### 未来扩展方向
- 支持更多PE结构分析
- 添加其他哈希算法（SHA512等）
- 导出分析报告功能
- 批量文件处理

## 测试验证

### 核心功能测试
- PE文件识别准确性
- 导入表解析完整性
- 哈希计算正确性

### 边界条件测试
- 损坏PE文件处理
- 大文件性能测试
- 特殊字符路径支持

### 兼容性测试
- 不同Windows版本
- 各种PE文件格式
- Unicode文件路径

这个PE分析工具提供了专业级的PE文件分析和哈希计算功能，采用现代化的C++设计，确保代码质量和可维护性。